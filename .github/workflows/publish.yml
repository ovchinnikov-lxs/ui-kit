    name: Publish

    on:
        push:
            branches:
                - master

    jobs:
        lint:
            runs-on: ubuntu-latest
            strategy:
                matrix:
                    node-version: [16.x]
            steps:
                - uses: actions/checkout@v2
                - uses: actions/setup-node@v1
                  with:
                      node-version: ${{ matrix.node-version }}
                - run: npm ci
                - run: npm run lint:check

        test_build:
            needs:
                - lint
            runs-on: ubuntu-latest
            strategy:
                matrix:
                    node-version: [16.x]
            steps:
                - uses: actions/checkout@v2
                - uses: actions/setup-node@v1
                  with:
                      node-version: ${{ matrix.node-version }}
                - run: npm ci
                - run: npm run build

        publish:
            env:
                NODE_AUTH_TOKEN: ${{ secrets.MY_TOKEN }}
            needs:
                - lint
                - test_build
            permissions:
                packages: write
                contents: read
            runs-on: ubuntu-latest
            strategy:
                matrix:
                    node-version: [16.x]
            steps:
                - uses: actions/checkout@v3
                - uses: actions/setup-node@v3
                  with:
                      node-version: ${{ matrix.node-version }}
                      registry-url: https://npm.pkg.github.com/
                - run: npm ci
                - run: |
                      git config --global user.email "${{ github.event.pusher.email }}"
                      git config --global user.name "${{ github.event.pusher.name }}"
                - run: npm run bump
                - run: git push && git push --tags
                - run: npm run build
                - run: npm cache verify
                - run: npm publish
